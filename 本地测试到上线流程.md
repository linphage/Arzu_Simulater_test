# é‡å¤ä»»åŠ¡åŠŸèƒ½æœ¬åœ°æµ‹è¯•åˆ°ä¸Šçº¿æµç¨‹

## å‰ææ¡ä»¶
- âœ… å·²å®‰è£… PostgreSQL 17 (è·¯å¾„: C:\Program Files\PostgreSQL\17)
- âœ… å·²å¤‡ä»½ Render æ•°æ®åº“
- âœ… æœ¬åœ°æœ‰åç«¯ä»£ç 

---

## é˜¶æ®µä¸€ï¼šæœ¬åœ° PostgreSQL ç¯å¢ƒå‡†å¤‡

### æ­¥éª¤ 1ï¼šåˆ›å»ºæœ¬åœ°æµ‹è¯•æ•°æ®åº“

æ‰“å¼€ **å‘½ä»¤æç¤ºç¬¦**ï¼ˆä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œï¼‰ï¼š

```bash
# 1. è¿æ¥åˆ° PostgreSQLï¼ˆä¼šæç¤ºè¾“å…¥å¯†ç ï¼‰
"C:\Program Files\PostgreSQL\17\bin\psql.exe" -U postgres

# 2. åœ¨ psql å‘½ä»¤è¡Œä¸­åˆ›å»ºæµ‹è¯•æ•°æ®åº“
CREATE DATABASE arzu_test;

# 3. é€€å‡º psql
\q
```

### æ­¥éª¤ 2ï¼šä» Render å¯¼å…¥æ•°æ®åˆ°æœ¬åœ°

```bash
# æ–¹å¼1ï¼šå¦‚æœä½ å·²ç»æœ‰å¤‡ä»½æ–‡ä»¶ï¼ˆbackup.sqlï¼‰
"C:\Program Files\PostgreSQL\17\bin\psql.exe" -U postgres -d arzu_test -f backup.sql

# æ–¹å¼2ï¼šç›´æ¥ä» Render å¯¼å‡ºå¹¶å¯¼å…¥ï¼ˆéœ€è¦ Render DATABASE_URLï¼‰
# æ›¿æ¢ <RENDER_DATABASE_URL> ä¸ºä½ çš„å®é™… URL
"C:\Program Files\PostgreSQL\17\bin\pg_dump.exe" "<RENDER_DATABASE_URL>" | "C:\Program Files\PostgreSQL\17\bin\psql.exe" -U postgres -d arzu_test
```

### æ­¥éª¤ 3ï¼šæ‰§è¡Œè¿ç§»è„šæœ¬

```bash
# å¯¼èˆªåˆ°é¡¹ç›®ç›®å½•
cd C:\Users\Amber\Desktop\Arzu_Simulater_test_backup\Arzu_simulator_back

# æ‰§è¡Œ PostgreSQL è¿ç§»è„šæœ¬
"C:\Program Files\PostgreSQL\17\bin\psql.exe" -U postgres -d arzu_test -f src\database\migrations\012-add-repeat-task-support-postgres.sql
```

**éªŒè¯è¿ç§»æ˜¯å¦æˆåŠŸ**ï¼š
```bash
"C:\Program Files\PostgreSQL\17\bin\psql.exe" -U postgres -d arzu_test

# åœ¨ psql ä¸­æ‰§è¡Œï¼š
\d tasks  # æŸ¥çœ‹ tasks è¡¨ç»“æ„ï¼Œåº”è¯¥èƒ½çœ‹åˆ° parent_task_id å’Œ repeat_days (TEXT) å­—æ®µ
\q
```

---

## é˜¶æ®µäºŒï¼šé…ç½®æœ¬åœ°ç¯å¢ƒè¿æ¥ PostgreSQL

### æ­¥éª¤ 4ï¼šåˆ›å»ºæœ¬åœ°ç¯å¢ƒå˜é‡æ–‡ä»¶

åœ¨åç«¯é¡¹ç›®æ ¹ç›®å½•åˆ›å»º `.env.local` æ–‡ä»¶ï¼š

```env
# .env.local
NODE_ENV=development
PORT=3001

# æœ¬åœ° PostgreSQL è¿æ¥ï¼ˆæ ¹æ®ä½ çš„å®é™…é…ç½®ä¿®æ”¹ï¼‰
DATABASE_URL=postgresql://postgres:ä½ çš„å¯†ç @localhost:5432/arzu_test

# JWT é…ç½®
JWT_SECRET=your_local_jwt_secret_min_32_chars_long
JWT_REFRESH_SECRET=your_local_refresh_secret_min_32_chars_long
JWT_EXPIRES_IN=4h
JWT_REFRESH_EXPIRES_IN=30d

# CORS é…ç½®
CORS_ORIGIN=http://localhost:3000,http://localhost:3001

# æ—¥å¿—çº§åˆ«
LOG_LEVEL=debug
```

**é‡è¦**ï¼šå°† `ä½ çš„å¯†ç ` æ›¿æ¢ä¸ºä½ å®‰è£… PostgreSQL æ—¶è®¾ç½®çš„ postgres ç”¨æˆ·å¯†ç ã€‚

### æ­¥éª¤ 5ï¼šå¯åŠ¨æœ¬åœ°åç«¯æµ‹è¯•

```bash
# 1. å®‰è£…ä¾èµ–ï¼ˆå¦‚æœè¿˜æ²¡å®‰è£…ï¼‰
npm install

# 2. ç¼–è¯‘ TypeScript
npm run build

# 3. ä½¿ç”¨æœ¬åœ°é…ç½®å¯åŠ¨ï¼ˆLinux/Macï¼‰
NODE_ENV=development DATABASE_URL=postgresql://postgres:å¯†ç @localhost:5432/arzu_test npm start

# æˆ– Windows PowerShellï¼š
$env:DATABASE_URL="postgresql://postgres:å¯†ç @localhost:5432/arzu_test"
npm start

# æˆ–è€…ä¿®æ”¹ package.json çš„ start è„šæœ¬ï¼Œæ·»åŠ ç¯å¢ƒå˜é‡åŠ è½½
# "start": "node -r dotenv/config dist/index.js dotenv_config_path=.env.local"
```

---

## é˜¶æ®µä¸‰ï¼šæµ‹è¯•é‡å¤ä»»åŠ¡åŠŸèƒ½

### æ­¥éª¤ 6ï¼šæµ‹è¯•åœºæ™¯æ¸…å•

**ä½¿ç”¨ Postman æˆ–å‰ç«¯åº”ç”¨æµ‹è¯•**ï¼š

#### æµ‹è¯• 1ï¼šåˆ›å»ºé‡å¤ä»»åŠ¡ï¼ˆæ¨¡æ¿ï¼‰
```http
POST http://localhost:3001/api/v1/tasks
Authorization: Bearer <your_token>
Content-Type: application/json

{
  "title": "æ¯å‘¨æ™¨ä¼š",
  "description": "å›¢é˜Ÿå‘¨ä¾‹ä¼š",
  "category": "å‹¤æ”¿",
  "priority": "é‡‘",
  "dueDate": "2025-01-13T09:00:00.000Z",
  "repeatDays": "[1,3,5]"  // å‘¨ä¸€ã€å‘¨ä¸‰ã€å‘¨äº”
}
```

**é¢„æœŸç»“æœ**ï¼š
- âœ… åˆ›å»ºæ¨¡æ¿ä»»åŠ¡æˆåŠŸ
- âœ… è‡ªåŠ¨ç”Ÿæˆæœ¬å‘¨ä¸€ã€ä¸‰ã€äº”çš„å®ä¾‹ä»»åŠ¡
- âœ… æŸ¥çœ‹æ•°æ®åº“ï¼Œå®ä¾‹ä»»åŠ¡çš„ `parent_task_id` æŒ‡å‘æ¨¡æ¿

**éªŒè¯æŸ¥è¯¢**ï¼š
```sql
-- åœ¨ psql ä¸­æ‰§è¡Œ
SELECT id, title, due_date, parent_task_id, repeat_days 
FROM tasks 
WHERE title LIKE '%æ™¨ä¼š%' 
ORDER BY due_date;
```

#### æµ‹è¯• 2ï¼šæ›´æ–°æ¨¡æ¿ä»»åŠ¡
```http
PUT http://localhost:3001/api/v1/tasks/1
Authorization: Bearer <your_token>
Content-Type: application/json

{
  "dueDate": "2025-01-13T10:00:00.000Z",  // æ”¹æ—¶é—´
  "repeatDays": "[1,2,3,4,5]"  // æ”¹ä¸ºå·¥ä½œæ—¥æ¯å¤©
}
```

**é¢„æœŸç»“æœ**ï¼š
- âœ… åˆ é™¤æ—§çš„æœªæ¥å®ä¾‹
- âœ… é‡æ–°ç”Ÿæˆæœ¬å‘¨å·¥ä½œæ—¥çš„å®ä¾‹

#### æµ‹è¯• 3ï¼šåˆ é™¤æ¨¡æ¿ä»»åŠ¡
```http
DELETE http://localhost:3001/api/v1/tasks/1?deleteInstances=true
Authorization: Bearer <your_token>
```

**é¢„æœŸç»“æœ**ï¼š
- âœ… è½¯åˆ é™¤æ¨¡æ¿ä»»åŠ¡
- âœ… åŒæ—¶åˆ é™¤æœªæ¥æœªå®Œæˆçš„å®ä¾‹

#### æµ‹è¯• 4ï¼šæŸ¥çœ‹æ—¥å¿—
æ£€æŸ¥åç«¯æ—¥å¿—ï¼Œåº”è¯¥èƒ½çœ‹åˆ°ï¼š
```
[INFO] æ£€æµ‹åˆ°é‡å¤ä»»åŠ¡ï¼Œå¼€å§‹ç”Ÿæˆæœ¬å‘¨å®ä¾‹
[INFO] ä¸ºæ¨¡æ¿ä»»åŠ¡ #1 ç”Ÿæˆäº† 3 ä¸ªå®ä¾‹
```

---

## é˜¶æ®µå››ï¼šä¸Šçº¿åˆ° Render

### æ­¥éª¤ 7ï¼šç¡®è®¤æœ¬åœ°æµ‹è¯•é€šè¿‡åï¼Œå‡†å¤‡ä¸Šçº¿

#### 7.1 æäº¤ä»£ç åˆ° Git

```bash
cd C:\Users\Amber\Desktop\Arzu_Simulater_test_backup

git add .
git commit -m "feat: å®ç°å‘¨é‡å¤ä»»åŠ¡åŠŸèƒ½

- æ·»åŠ  parent_task_id å’Œ repeat_days å­—æ®µ
- å®ç° TaskGenerationService å‘¨ä»»åŠ¡ç”Ÿæˆ
- ä¿®æ”¹åˆ›å»º/æ›´æ–°/åˆ é™¤ API æ”¯æŒé‡å¤ä»»åŠ¡
- æ·»åŠ æ¯å‘¨ä¸€å®šæ—¶ä»»åŠ¡è‡ªåŠ¨ç”Ÿæˆä¸‹å‘¨ä»»åŠ¡
- æ•°æ®åº“è¿ç§»è„šæœ¬ï¼ˆPostgreSQL å’Œ SQLiteï¼‰

ğŸ¤– Generated with Claude Code"

git push origin main
```

### æ­¥éª¤ 8ï¼šåœ¨ Render æ‰§è¡Œæ•°æ®åº“è¿ç§»

#### æ–¹å¼ 1ï¼šé€šè¿‡ Render Shellï¼ˆæ¨èï¼‰

1. ç™»å½• Render Dashboard
2. è¿›å…¥ä½ çš„ **Web Service**
3. ç‚¹å‡»å³ä¸Šè§’ **Shell** æ ‡ç­¾
4. åœ¨ Shell ä¸­æ‰§è¡Œï¼š

```bash
# æŸ¥çœ‹è¿ç§»æ–‡ä»¶æ˜¯å¦å­˜åœ¨
ls src/database/migrations/

# æ‰§è¡Œè¿ç§»
psql $DATABASE_URL -f src/database/migrations/012-add-repeat-task-support-postgres.sql

# éªŒè¯
psql $DATABASE_URL -c "\d tasks"
```

#### æ–¹å¼ 2ï¼šæœ¬åœ°è¿æ¥ Render æ•°æ®åº“æ‰§è¡Œ

```bash
# ä» Render Dashboard å¤åˆ¶ DATABASE_URLï¼ˆExternal Database URLï¼‰

# æ‰§è¡Œè¿ç§»
"C:\Program Files\PostgreSQL\17\bin\psql.exe" "<RENDER_DATABASE_URL>" -f src\database\migrations\012-add-repeat-task-support-postgres.sql
```

### æ­¥éª¤ 9ï¼šRender è‡ªåŠ¨éƒ¨ç½²

Render ä¼šè‡ªåŠ¨æ£€æµ‹ Git æ¨é€å¹¶é‡æ–°éƒ¨ç½²ï¼š

1. æŸ¥çœ‹ **Render Dashboard â†’ ä½ çš„æœåŠ¡ â†’ Logs**
2. ç­‰å¾…éƒ¨ç½²å®Œæˆï¼ˆçº¦ 2-5 åˆ†é’Ÿï¼‰
3. æŸ¥çœ‹å¯åŠ¨æ—¥å¿—ï¼Œç¡®è®¤ï¼š
   ```
   å®šæ—¶ä»»åŠ¡å·²å¯åŠ¨ï¼š
     - æ¯æœˆ1æ—¥å‡Œæ™¨0:00ï¼ˆä¸œå…«åŒºï¼‰ï¼šé‡ç½®è¡¥æ‰“å¡æ¬¡æ•°
     - æ¯å‘¨ä¸€å‡Œæ™¨0:00ï¼ˆä¸œå…«åŒºï¼‰ï¼šç”Ÿæˆä¸‹ä¸€å‘¨é‡å¤ä»»åŠ¡
   ```

### æ­¥éª¤ 10ï¼šçº¿ä¸ŠéªŒè¯

ä½¿ç”¨å‰ç«¯æˆ– Postman è¿æ¥çº¿ä¸Š API æµ‹è¯•ï¼š
```http
POST https://your-app.onrender.com/api/v1/tasks
Authorization: Bearer <token>

{
  "title": "æµ‹è¯•é‡å¤ä»»åŠ¡",
  "repeatDays": "[1,3,5]",
  "dueDate": "2025-01-13T09:00:00.000Z"
}
```

---

## æ•…éšœæ’æŸ¥

### é—®é¢˜ 1ï¼šè¿ç§»è„šæœ¬æŠ¥é”™ "column already exists"
**è§£å†³**ï¼šå­—æ®µå·²å­˜åœ¨ï¼Œè·³è¿‡æˆ–åˆ é™¤è¯¥ ALTER è¯­å¥

### é—®é¢˜ 2ï¼šè¿æ¥æœ¬åœ° PostgreSQL å¤±è´¥
**æ£€æŸ¥**ï¼š
```bash
# ç¡®è®¤ PostgreSQL æœåŠ¡æ­£åœ¨è¿è¡Œ
services.msc  # æ‰¾åˆ° postgresql-x64-17ï¼Œç¡®ä¿å·²å¯åŠ¨

# æµ‹è¯•è¿æ¥
"C:\Program Files\PostgreSQL\17\bin\psql.exe" -U postgres -d arzu_test
```

### é—®é¢˜ 3ï¼šRender éƒ¨ç½²åå®šæ—¶ä»»åŠ¡æœªå¯åŠ¨
**æ£€æŸ¥æ—¥å¿—**ï¼š
```bash
# åœ¨ Render Shell ä¸­
node -e "console.log('å®šæ—¶ä»»åŠ¡æµ‹è¯•:', require('./dist/utils/scheduler'))"
```

### é—®é¢˜ 4ï¼šrepeat_days æ ¼å¼é”™è¯¯
**ç¡®ä¿å‰ç«¯å‘é€ JSON æ•°ç»„å­—ç¬¦ä¸²**ï¼š
```json
{
  "repeatDays": "[0,1,2,3,4,5,6]"  // âœ… æ­£ç¡®
  "repeatDays": [0,1,2,3,4,5,6]    // âœ… ä¹Ÿæ”¯æŒï¼ˆä¼šè‡ªåŠ¨è½¬æ¢ï¼‰
  "repeatDays": 127                 // âŒ æ—§æ ¼å¼ï¼ˆä¼šå°è¯•è½¬æ¢ä½†ä¸æ¨èï¼‰
}
```

---

## å¤‡ä»½å’Œå›æ»š

### å¦‚æœä¸Šçº¿åå‡ºç°é—®é¢˜

#### å›æ»šæ•°æ®åº“ï¼ˆRenderï¼‰
```bash
# æ¢å¤ä¹‹å‰çš„å¤‡ä»½
psql $DATABASE_URL < backup_20250110.sql
```

#### å›æ»šä»£ç 
```bash
git revert HEAD
git push origin main
```

---

## æ—¶é—´çº¿å»ºè®®

- **æœ¬åœ°æµ‹è¯•**ï¼š1-2 å°æ—¶ï¼ˆç¡®ä¿æ‰€æœ‰åœºæ™¯é€šè¿‡ï¼‰
- **Render è¿ç§»**ï¼š10 åˆ†é’Ÿ
- **Render éƒ¨ç½²**ï¼š5 åˆ†é’Ÿ
- **çº¿ä¸ŠéªŒè¯**ï¼š30 åˆ†é’Ÿ

**æ€»è®¡**ï¼šçº¦ 2-3 å°æ—¶

---

## æ£€æŸ¥æ¸…å•

### æœ¬åœ°æµ‹è¯•é˜¶æ®µ
- [ ] PostgreSQL è¿æ¥æˆåŠŸ
- [ ] è¿ç§»è„šæœ¬æ‰§è¡Œæ— é”™è¯¯
- [ ] åˆ›å»ºé‡å¤ä»»åŠ¡ç”Ÿæˆå®ä¾‹
- [ ] æ›´æ–°æ¨¡æ¿ä»»åŠ¡é‡æ–°ç”Ÿæˆå®ä¾‹
- [ ] åˆ é™¤æ¨¡æ¿ä»»åŠ¡çº§è”åˆ é™¤å®ä¾‹
- [ ] æŸ¥çœ‹æ—¥å¿—æ— å¼‚å¸¸

### ä¸Šçº¿é˜¶æ®µ
- [ ] ä»£ç å·²æäº¤åˆ° Git
- [ ] Render æ•°æ®åº“å·²å¤‡ä»½
- [ ] è¿ç§»è„šæœ¬åœ¨ Render æ‰§è¡ŒæˆåŠŸ
- [ ] Render è‡ªåŠ¨éƒ¨ç½²å®Œæˆ
- [ ] å®šæ—¶ä»»åŠ¡æ—¥å¿—æ­£å¸¸
- [ ] çº¿ä¸Šåˆ›å»ºæµ‹è¯•ä»»åŠ¡æˆåŠŸ

---

ç¥ä¸Šçº¿é¡ºåˆ©ï¼ğŸš€

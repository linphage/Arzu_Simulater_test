# å‰ç«¯å¥–åŠ±å¡ä¿®æ”¹æŒ‡å—

## éœ€è¦ä¿®æ”¹çš„æ–‡ä»¶ï¼š`Arzu_simulator_front/src/App.tsx`

### 1. ä¿®æ”¹ RewardCard æ¥å£å®šä¹‰ï¼ˆçº¦ç¬¬54-61è¡Œï¼‰

**åŸæ¥çš„ä»£ç ï¼š**
```typescript
interface RewardCard {
  id: string;
  title: string;
  content: string;
  obtainedAt: Date;
  triggerTime: number; // è§¦å‘å¥–åŠ±æ—¶çš„ç´¯è®¡ä¸“æ³¨æ—¶é•¿ï¼ˆæ¯«ç§’ï¼‰
  isViewed?: boolean; // æ˜¯å¦å·²æŸ¥çœ‹ï¼Œç”¨äºæ’åº
}
```

**ä¿®æ”¹ä¸ºï¼š**
```typescript
interface RewardCard {
  id: number;
  title: string;
  description: string;
  obtainedAt: Date;
  triggerTime: number; // è§¦å‘å¥–åŠ±æ—¶çš„ç´¯è®¡ä¸“æ³¨æ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰
  isViewed: boolean; // æ˜¯å¦å·²æŸ¥çœ‹ï¼Œç”¨äºæ’åº
}
```

### 2. åœ¨æ–‡ä»¶é¡¶éƒ¨æ·»åŠ å¯¼å…¥ï¼ˆçº¦ç¬¬1-20è¡Œï¼‰

**æ·»åŠ ï¼š**
```typescript
import { rewardService } from './services/rewardService';
```

### 3. æ·»åŠ  useEffect åŠ è½½å¥–åŠ±å¡ï¼ˆçº¦ç¬¬84è¡Œåï¼‰

**æ·»åŠ ï¼š**
```typescript
// ä»åç«¯åŠ è½½å¥–åŠ±å¡
useEffect(() => {
  if (isLoggedIn) {
    const loadRewards = async () => {
      try {
        const rewards = await rewardService.getUserRewards();
        const mappedRewards: RewardCard[] = rewards.map(r => ({
          id: r.id,
          title: r.title,
          description: r.description,
          obtainedAt: new Date(r.obtained_at),
          triggerTime: r.trigger_time_minutes,
          isViewed: r.is_viewed === true || r.is_viewed === 1
        }));
        setRewardCards(mappedRewards);
      } catch (error) {
        console.error('åŠ è½½å¥–åŠ±å¡å¤±è´¥:', error);
      }
    };
    loadRewards();
  }
}, [isLoggedIn]);
```

### 4. ä¿®æ”¹ checkRewardTrigger å‡½æ•°ï¼ˆçº¦ç¬¬130-162è¡Œï¼‰

**æ›¿æ¢æ•´ä¸ªå‡½æ•°ä¸ºï¼š**
```typescript
const checkRewardTrigger = async (newTotalTime: number) => {
  const timeSinceLastReward = newTotalTime - lastRewardTriggerTime;
  const isTestMode = false;
  const testModeDivider = isTestMode ? 10 : 1;
  
  const nextRewardTime = generateRandomRewardTriggerTime() / testModeDivider;
  
  console.log(`ğŸ [å¥–åŠ±æ£€æŸ¥] å½“å‰ç´¯è®¡æ—¶é—´: ${Math.round(newTotalTime / 60000)}åˆ†é’Ÿ`);
  console.log(`ğŸ [å¥–åŠ±æ£€æŸ¥] è·ä¸Šæ¬¡å¥–åŠ±æ—¶é—´: ${Math.round(timeSinceLastReward / 60000)}åˆ†é’Ÿ`);
  console.log(`ğŸ [å¥–åŠ±æ£€æŸ¥] éœ€è¦ç´¯è®¡æ—¶é—´: ${Math.round(nextRewardTime / 60000)}åˆ†é’Ÿ`);
  
  if (timeSinceLastReward >= nextRewardTime) {
    try {
      const triggerTimeMinutes = Math.round(newTotalTime / 60000);
      const reward = await rewardService.triggerReward(triggerTimeMinutes);
      
      const newRewardCard: RewardCard = {
        id: reward.id,
        title: reward.title,
        description: reward.description,
        obtainedAt: new Date(reward.obtained_at),
        triggerTime: reward.trigger_time_minutes,
        isViewed: false
      };
      
      setRewardCards(prev => [newRewardCard, ...prev]);
      setLastRewardTriggerTime(newTotalTime);
      
      console.log(`ğŸ‰ [å¥–åŠ±è§¦å‘] è·å¾—å¥–åŠ±å¡: ${newRewardCard.title}`);
      
      setTimeout(() => {
        alert(`ğŸ‰ æ­å–œè·å¾—å¥–åŠ±å¡ï¼\n\n${newRewardCard.title}\n${newRewardCard.description}`);
      }, 500);
    } catch (error) {
      console.error('è§¦å‘å¥–åŠ±å¤±è´¥:', error);
    }
  }
};
```

### 5. åˆ é™¤æ—§çš„ generateRewardCard å‡½æ•°ï¼ˆçº¦ç¬¬109-129è¡Œï¼‰

**å®Œå…¨åˆ é™¤è¿™ä¸ªå‡½æ•°ï¼Œä¸å†éœ€è¦å‰ç«¯ç”Ÿæˆå¥–åŠ±æ–‡æ¡ˆ**

### 6. ä¿®æ”¹ handleManualReward å‡½æ•°ï¼ˆçº¦ç¬¬164-170è¡Œï¼‰

**æ›¿æ¢ä¸ºï¼š**
```typescript
const handleManualReward = async () => {
  try {
    const triggerTimeMinutes = Math.round(totalFocusTime / 60000);
    const reward = await rewardService.triggerReward(triggerTimeMinutes);
    
    const newRewardCard: RewardCard = {
      id: reward.id,
      title: reward.title,
      description: reward.description,
      obtainedAt: new Date(reward.obtained_at),
      triggerTime: reward.trigger_time_minutes,
      isViewed: false
    };
    
    setRewardCards(prev => [newRewardCard, ...prev]);
    console.log(`ğŸ§ª [æ‰‹åŠ¨å¥–åŠ±] ç”Ÿæˆæµ‹è¯•å¥–åŠ±å¡: ${newRewardCard.title}`);
    alert(`ğŸ§ª æµ‹è¯•å¥–åŠ±å¡å·²ç”Ÿæˆï¼\n\n${newRewardCard.title}\n${newRewardCard.description}`);
  } catch (error) {
    console.error('æ‰‹åŠ¨è§¦å‘å¥–åŠ±å¤±è´¥:', error);
    alert('è§¦å‘å¥–åŠ±å¤±è´¥ï¼Œè¯·æ£€æŸ¥åç«¯æœåŠ¡');
  }
};
```

### 7. ä¿®æ”¹ handleDeleteRewardCard å‡½æ•°ï¼ˆçº¦ç¬¬172-177è¡Œï¼‰

**æ›¿æ¢ä¸ºï¼š**
```typescript
const handleDeleteRewardCard = async (cardId: number) => {
  if (window.confirm('ç¡®å®šè¦åˆ é™¤è¿™å¼ å¥–åŠ±å¡å—ï¼Ÿ')) {
    try {
      await rewardService.deleteReward(cardId);
      setRewardCards(prev => prev.filter(card => card.id !== cardId));
      console.log(`ğŸ—‘ï¸ [å¥–åŠ±å¡] åˆ é™¤å¥–åŠ±å¡: ${cardId}`);
    } catch (error) {
      console.error('åˆ é™¤å¥–åŠ±å¡å¤±è´¥:', error);
      alert('åˆ é™¤å¤±è´¥ï¼Œè¯·é‡è¯•');
    }
  }
};
```

### 8. ä¿®æ”¹ handleRewardClick å‡½æ•°ï¼ˆçº¦ç¬¬195-209è¡Œï¼‰

**æ›¿æ¢ä¸ºï¼š**
```typescript
const handleRewardClick = async (rewardCard: RewardCard) => {
  if (!rewardCard.isViewed) {
    try {
      await rewardService.markAsViewed(rewardCard.id);
      setRewardCards(prev => prev.map(card => 
        card.id === rewardCard.id 
          ? { ...card, isViewed: true }
          : card
      ));
      console.log(`ğŸ‘ï¸ [å¥–åŠ±æŸ¥çœ‹] å¥–åŠ±å¡ "${rewardCard.title}" å·²æ ‡è®°ä¸ºå·²æŸ¥çœ‹`);
    } catch (error) {
      console.error('æ ‡è®°å¥–åŠ±å¤±è´¥:', error);
    }
  }
  
  setSelectedReward({ ...rewardCard, isViewed: true });
  setCurrentView('reward');
};
```

### 9. ä¿®æ”¹æ‰€æœ‰ä½¿ç”¨ rewardCard.content çš„åœ°æ–¹

åœ¨æ•´ä¸ªæ–‡ä»¶ä¸­æœç´¢ `rewardCard.content`ï¼Œå…¨éƒ¨æ›¿æ¢ä¸º `rewardCard.description`

## éœ€è¦ä¿®æ”¹çš„æ–‡ä»¶ï¼š`Arzu_simulator_front/src/components/RewardCard.tsx`

### ä¿®æ”¹ content ä¸º descriptionï¼ˆç¬¬8è¡Œå’Œç¬¬113è¡Œï¼‰

**ç¬¬8è¡Œï¼š**
```typescript
description: string;  // æ”¹ä¸º description
```

**æ‰€æœ‰ä½¿ç”¨çš„åœ°æ–¹ä¹Ÿæ”¹ä¸º description**

## éœ€è¦ä¿®æ”¹çš„æ–‡ä»¶ï¼š`Arzu_simulator_front/src/components/RewardView.tsx`

### ä¿®æ”¹ content ä¸º description

1. æ¥å£å®šä¹‰ï¼ˆç¬¬9è¡Œï¼‰æ”¹ä¸º `description: string;`
2. ç¬¬129è¡Œçš„ `{rewardCard.content}` æ”¹ä¸º `{rewardCard.description}`
3. å¦‚æœ description åŒ…å« `\n`ï¼Œéœ€è¦å¤„ç†æ¢è¡Œï¼š

```typescript
<div className="text-[14px] font-['ABeeZee:Regular','Noto_Sans_SC:Regular','Noto_Sans_JP:Regular',sans-serif] text-[#3a3f47] leading-relaxed">
  {rewardCard.description.split('\\n').map((line, index) => (
    <p key={index} className="mb-2">{line}</p>
  ))}
</div>
```

## å®Œæˆåæµ‹è¯•

1. é‡å¯åç«¯æœåŠ¡
2. åˆ·æ–°å‰ç«¯
3. æµ‹è¯•æ‰‹åŠ¨è§¦å‘å¥–åŠ±
4. å®Œæˆä¸“æ³¨ä»»åŠ¡æµ‹è¯•è‡ªåŠ¨è§¦å‘å¥–åŠ±
5. æµ‹è¯•æŸ¥çœ‹å’Œåˆ é™¤å¥–åŠ±å¡
